# PNAS_Nacre
Nacre analysis code for hyperspectral imaging tomography. Jad Salman.
HOW TO USE:
1) Nacre_total_analysis_v2_PNAS.m is the main script for performing analysis of hyperspectral data cubes, fitting analysis of spectra, scrubbing of data, and plotting of figures. The files normalize.m, parseHdrInfo_IQ.m, ratioPart_IQ.m, reflectance_IQ.m, and reshapeImage_IQ.m should be in the same working directory as the total_analysis file.
2) This code parses hyperspectral data cubes generated by the Specim IQ (produced by Specim OY). Hyperspectral data cubes are in the ENVI format.
3) Simulated nacre reflectances were generated using the code provided in HTC_spectral_fit_ppol_example_PNAS.m. This code is formatted for running on a high-throughput computing system. This code requires function trnsfr_mm_dspless.m to calculate the reflectances for p-polarized light across all wavelengths and angles defined. Also the user needs to define their 'in*.mat' input files based on the number of jobs for which they want to subdivide their simulations (m x n simulations for m mean tablet thicknesses and n tablet standard deviations). 
4) HTC_R_out_combine_example_PNAS.m can be used to combine the individual 'out*.mat' files into one m x n matrix for use in Nacre_total_analysis_v2_PNAS.m fitting. Once an m x n reflectance matrix has been simulated for a given angle of incidence and parameters, you do not need to rerun the HTC code unless you need to simulate a different angle of incidence or structure.
